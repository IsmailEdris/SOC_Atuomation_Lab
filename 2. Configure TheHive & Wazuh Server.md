# Objective
The objective of this step is to configure TheHive and Wazuh servers to ensure they are fully operational. This configuration will enable the Windows client to establish communication with the servers and report critical security events and logs effectively.

## Step 1. Configuring TheHive

The objective of this step is to configure TheHive server by modifying Cassandra's configuration files. These changes are necessary to ensure that Cassandra, as TheHive's database, is properly integrated and communicates seamlessly with TheHive's server.


### Steps Performed

### 1. Edited Cassandra's Configuration Files
Key changes were made to the `cassandra.yaml` configuration file to align it with TheHive server's settings. The following parameters were updated:

- **Cluster Name**: Changed from `test cluster` to `mydfr` to provide a unique and identifiable name for the cluster.
- **listen_address**: Updated from `localhost` to `161.35.6.162` to specify TheHive server's IP address, allowing it to listen for incoming connections.
- **rpc_address**: Updated from `localhost` to `161.35.6.162` to configure the IP address used for remote procedure calls.
- **seed**: Set to `161.35.6.162:7000` to ensure Cassandra can communicate with the seed node, which is the same as TheHive server's IP address.



### Configuration Changes Example
Below are the specific configuration changes made in the `cassandra.yaml` file:

```yaml
cluster_name: 'mydfr'
listen_address: '161.35.6.162'
rpc_address: '161.35.6.162'
seed_provider:
  - class_name: org.apache.cassandra.locator.SimpleSeedProvider
    parameters:
      - seeds: '161.35.6.162:7000'
```
---

### 2. Performed Cassandra Maintenance
After modifying the configuration files, additional maintenance steps were performed to clear old data and restart the Cassandra service. These steps ensured that the new configuration changes were applied and that Cassandra was running smoothly.

Commands executed:

```bash
# Stop the Cassandra service
systemctl stop cassandra.service

# Clear old Cassandra data
rm -rf /var/lib/cassandra/*

# Start the Cassandra service
systemctl start cassandra.service

# Check the status of the Cassandra service
systemctl status cassandra.service
```
---

## Step 2. Configuring Elasticsearch

The objective of this step is to configure the Elasticsearch `elasticsearch.yml` file to integrate it with TheHive server. These changes ensure that Elasticsearch is properly set up for indexing and searching within TheHive's ecosystem.


### Steps Performed

### 1. Edited `elasticsearch.yml`
Key configurations were made in the `elasticsearch.yml` file to align it with TheHive's requirements. The following changes were implemented:

- **Cluster Name**: Updated from `my-application` to `the-hive` to associate it with TheHive's cluster.
- **Node Name**: Uncommented and configured to uniquely identify this node within the cluster.
- **Network Host**: Updated to TheHive's public IP address (157.230.234.213) to allow external communication.
- **HTTP Port**: Uncommented the default HTTP port `9200` for RESTful communication.
- **Cluster Initial Master Node**: Uncommented this setting and removed references to `node-2` to simplify the configuration for a single-node setup.


### Configuration Changes Example
Below are the specific changes made in the `elasticsearch.yml` file:

```yaml
cluster.name: 'the-hive'
node.name: 'node-1'
network.host: '161.35.6.162' # TheHive's public IP address
http.port: 9200
cluster.initial_master_nodes: ["node-1"]
```

--- 

## Step 3. Configuring TheHive


The objective of this step is to configure TheHive server and ensure proper file permissions and configuration settings. These changes are necessary for TheHive to operate correctly and integrate seamlessly with other services, such as Elasticsearch and Cassandra.


### Steps Performed

### 1. Verified File Permissions
TheHive and its group were granted access to the `/opt/thp` file path to ensure the server could access the required directories. Proper permissions are critical for TheHive to function without issues.

Commands executed to verify and set permissions:

```bash
# Verify ownership and permissions of /opt/thp
ls -ld /opt/thp

# Ensure thehive user and group have the correct permissions
chown -R thehive:thehive /opt/thp
```

### 2. Edited TheHive Configuration File
TheHive's configuration file was accessed and updated to match the server's settings. The configuration file is located at `/etc/thehive/application.conf` and was edited using the `nano` text editor.

#### Commands Executed to Edit the Configuration File:
```bash
nano /etc/thehive/application.conf
```

### Changes Made in the Configuration File

The following changes were made to the configuration file:

```yaml
hostname="157.230.234.213" # TheHive's public IP address
cluster.name="mydfir" # Cluster name consistent with Cassandra configuration
index.search.hosts=["http://157.230.234.213"] # TheHive's IP address for search operations
application.baseUrl="http://157.230.234.213:9000" # TheHive's public URL for external access
```

